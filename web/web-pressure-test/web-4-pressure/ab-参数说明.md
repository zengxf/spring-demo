## 示例
```bash
ab -n 10000 -c 200 -m GET http://localhost:9001/mock/http/baidu
```

---

## 🧩 一、整体作用

这条命令的含义是：

> 对 `http://localhost:9001/mock/http/baidu` 这个接口发起 **10000 个 GET 请求**，
> 并且同时保持 **200 个并发连接**。

---

## ⚙️ 二、参数详解

| 参数    | 全称                     | 含义                                         | 示例                                      |
| ----- | ---------------------- | ------------------------------------------ | --------------------------------------- |
| `-n`  | **Number of requests** | 总请求数。表示要执行多少次 HTTP 请求。                     | `-n 10000` → 一共发 1 万次请求                 |
| `-c`  | **Concurrency**        | 并发数。表示同时保持多少个请求在进行。                        | `-c 200` → 同时 200 个连接                   |
| `-m`  | **HTTP method**        | 指定 HTTP 方法（GET、POST、PUT、DELETE 等）。默认是 GET。 | `-m GET`                                |
| （URL） | -                      | 目标请求地址                                     | `http://localhost:9001/mock/http/baidu` |

---

## 🧠 三、一些常用扩展参数（实战必备）

| 参数   | 说明                                      | 示例                                 |
| ---- | --------------------------------------- | ---------------------------------- |
| `-T` | Content-Type 请求头（配合 POST/PUT 用）         | `-T 'application/json'`            |
| `-p` | 从文件读取请求体（POST/PUT）                      | `-p data.json`                     |
| `-H` | 自定义请求头                                  | `-H 'Authorization: Bearer token'` |
| `-k` | 启用 HTTP Keep-Alive（默认关闭）                | `-k`                               |
| `-r` | 忽略 socket 错误，继续测试                       | `-r`                               |
| `-l` | 不检查响应长度差异（防止 “Failed requests: Length”） | `-l`                               |
| `-t` | 指定测试总时间（秒），替代 `-n`                      | `-t 30`                            |
| `-v` | 输出详细日志（1~4 级别）                          | `-v 2`                             |
| `-g` | 输出结果为 TSV 文件，可导入 Excel/gnuplot          | `-g result.tsv`                    |
| `-e` | 输出结果为 CSV 文件（适合图表分析）                    | `-e result.csv`                    |

---

## 🧮 四、执行逻辑解析

执行时，AB 会：

1. 先建立最多 `-c`（200）个并发连接；
2. 每个连接发送 HTTP 请求，直到总数达到 `-n`（10000）；
3. 记录每个请求的响应时间、字节数、失败数；
4. 输出汇总报告。

---

## ⚠️ 五、注意事项与陷阱

| 问题                                               | 原因                     | 解决方案                            |
| ------------------------------------------------ | ---------------------- | ------------------------------- |
| ❌ 报错：`apr_socket_recv: Connection reset by peer` | 被测服务器连接被重置（过载或拒绝）      | 降低 `-c` 并发数，例如改成 `-c 50`        |
| ❌ “Failed requests: Length”                      | 响应内容长度不一致              | 加 `-l` 忽略                       |
| ❌ 服务器被打挂                                         | 请求太多，资源（线程、连接）耗尽       | 逐步提高并发，观察服务极限                   |
| ❌ `-m` 不是所有版本都支持                                 | 老版本 ab 只能自动识别 GET/POST | 使用最新 ab（2.3+）或用 `-p` 指定 POST 文件 |

---

## 📊 六、实际示例对比

### 示例 1：GET 请求

```bash
ab -n 10000 -c 200 -m GET http://localhost:9001/mock/http/baidu
```

表示：

* 并发 200；
* 总计 10000；
* 使用 GET；
* 如果服务每次都返回 200 OK，就会看到 QPS、平均耗时等指标。

---

### 示例 2：POST JSON 请求

```bash
ab -n 5000 -c 100 -p post.json -T 'application/json' http://localhost:9001/api/test
```

`post.json` 内容：

```json
{"id":123,"msg":"hello"}
```

---

### 示例 3：忽略长度检查 + 启用 Keep-Alive

```bash
ab -n 20000 -c 200 -k -l http://localhost:9001/mock/http/baidu
```

---

## ⚡ 七、性能测试结果关键指标解读

| 字段                                                    | 含义                   |
| ----------------------------------------------------- | -------------------- |
| `Requests per second`                                 | **QPS（吞吐量）**         |
| `Time per request`                                    | 单请求平均耗时              |
| `Failed requests`                                     | 失败数量                 |
| `Transfer rate`                                       | 数据传输速率               |
| `Percentage of requests served within a certain time` | 百分位延迟分布（P50/P95/P99） |

---

## ✅ 八、推荐实践

| 场景     | 建议参数                                          |
| ------ | --------------------------------------------- |
| 快速压力探测 | `ab -n 1000 -c 50`                            |
| 高并发压测  | `ab -n 20000 -c 200 -k -l`                    |
| 接口稳定性  | `ab -n 100000 -c 100 -r`                      |
| 观察延迟分布 | `ab -n 5000 -c 100 -e result.csv` + Excel 可视化 |

---

## 🧩 九、小结

| 参数          | 功能         | 推荐用法                                 |
| ----------- | ---------- | ------------------------------------ |
| `-n`        | 总请求数       | `-n 10000`                           |
| `-c`        | 并发数        | `-c 200`                             |
| `-m`        | HTTP 方法    | `-m GET`（新版本支持）                      |
| `-k`        | Keep-Alive | `-k`（建议加上）                           |
| `-l`        | 忽略长度检查     | `-l`（防止误报失败）                         |
| `-p` + `-T` | POST 请求体   | `-p data.json -T 'application/json'` |